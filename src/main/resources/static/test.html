<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>JobSearch — test UI</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
        .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: end; }
        .card { border: 1px solid #ddd; border-radius: 10px; padding: 16px; margin-bottom: 16px; }
        label { display: block; font-size: 12px; color: #444; margin-bottom: 4px; }
        input, textarea { width: 320px; max-width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
        textarea { height: 90px; resize: vertical; }
        button { padding: 10px 14px; border: 1px solid #ccc; border-radius: 8px; background: #fff; cursor: pointer; }
        button:hover { background: #f6f6f6; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border-bottom: 1px solid #eee; padding: 10px; text-align: left; vertical-align: top; }
        th { background: #fafafa; }
        .muted { color: #666; font-size: 12px; }
        .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
        .pre { background:#fafafa; border:1px solid #eee; border-radius:10px; padding:12px; overflow:auto; white-space: pre-wrap; }
    </style>
</head>
<body>

<h2>JobSearch — тест API (без клиентской валидации)</h2>
<div class="muted">Эндпойнты: GET /vacancy, POST /vacancy</div>

<div class="card">
    <h3>Создать вакансию</h3>

    <div class="row">
        <div>
            <label for="companyName">companyName</label>
            <input id="companyName" placeholder="можно оставить пустым — проверим бэк" />
        </div>
        <div>
            <label for="vacancyName">vacancyName</label>
            <input id="vacancyName" placeholder="можно оставить пустым — проверим бэк" />
        </div>
    </div>

    <div style="margin-top:12px;">
        <label for="description">description</label>
        <textarea id="description" placeholder="можно оставить пустым"></textarea>
    </div>

    <div class="row" style="margin-top:12px;">
        <button id="postBtn">POST /vacancy</button>
        <button id="getBtn">GET /vacancy</button>
        <button id="clearBtn">Очистить вывод</button>
        <span id="status" class="muted"></span>
    </div>

    <div style="margin-top:12px;">
        <div class="muted">Ответ сервера (как есть):</div>
        <pre id="out" class="pre mono"></pre>
    </div>
</div>

<div class="card">
    <h3>Список вакансий (если GET вернул массив)</h3>
    <table>
        <thead>
        <tr>
            <th style="width:80px;">ID</th>
            <th style="width:220px;">Company</th>
            <th style="width:220px;">Vacancy</th>
            <th>Description</th>
        </tr>
        </thead>
        <tbody id="tbody">
        <tr><td colspan="4" class="muted">Нажми “GET /vacancy”</td></tr>
        </tbody>
    </table>
</div>

<script>
    const els = {
        companyName: document.getElementById("companyName"),
        vacancyName: document.getElementById("vacancyName"),
        description: document.getElementById("description"),
        postBtn: document.getElementById("postBtn"),
        getBtn: document.getElementById("getBtn"),
        clearBtn: document.getElementById("clearBtn"),
        status: document.getElementById("status"),
        out: document.getElementById("out"),
        tbody: document.getElementById("tbody"),
    };

    function setStatus(t) { els.status.textContent = t || ""; }

    function escapeHtml(s) {
        return String(s)
            .replaceAll("&", "&amp;")
            .replaceAll("<", "&lt;")
            .replaceAll(">", "&gt;")
            .replaceAll('"', "&quot;")
            .replaceAll("'", "&#039;");
    }

    async function callApi(path, options) {
        setStatus(`${options.method} ${path} ...`);
        els.out.textContent = "";

        const res = await fetch(path, options);
        const ct = res.headers.get("content-type") || "";
        const raw = await res.text();

        let json = null;
        try { json = raw ? JSON.parse(raw) : null; } catch (_) { /* ignore */ }

        // Печатаем ТО, ЧТО ВЕРНУЛ СЕРВЕР (HTTP + body)
        let out = [];
        out.push(`HTTP ${res.status} ${res.statusText}`);
        out.push(`Content-Type: ${ct || "(none)"}`);
        out.push("");
        out.push("Raw body:");
        out.push(raw || "(empty)");
        if (json) {
            out.push("");
            out.push("Parsed JSON:");
            out.push(JSON.stringify(json, null, 2));
        }
        els.out.textContent = out.join("\n");

        return { res, raw, json };
    }

    function renderTableIfArray(json) {
        if (!Array.isArray(json)) return;

        if (json.length === 0) {
            els.tbody.innerHTML = `<tr><td colspan="4" class="muted">Пока пусто</td></tr>`;
            return;
        }

        els.tbody.innerHTML = json.map(v => `
      <tr>
        <td>${escapeHtml(v.id ?? "")}</td>
        <td>${escapeHtml(v.companyName ?? "")}</td>
        <td>${escapeHtml(v.vacancyName ?? "")}</td>
        <td>${escapeHtml(v.description ?? "")}</td>
      </tr>
    `).join("");
    }

    els.postBtn.addEventListener("click", async () => {
        // НИКАКОЙ клиентской валидации — отправляем как есть
        const payload = {
            companyName: els.companyName.value, // оставляем как ввели (может быть пустым)
            vacancyName: els.vacancyName.value,
            description: els.description.value,
        };

        try {
            await callApi("/vacancy", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            });
            setStatus("Готово");
        } catch (e) {
            // Это не “валидация”, это техническая ошибка fetch (например, сервер недоступен)
            els.out.textContent = String(e);
            setStatus("Fetch error");
        }
    });

    els.getBtn.addEventListener("click", async () => {
        try {
            const r = await callApi("/vacancy", { method: "GET" });
            renderTableIfArray(r.json);
            setStatus("Готово");
        } catch (e) {
            els.out.textContent = String(e);
            setStatus("Fetch error");
        }
    });

    els.clearBtn.addEventListener("click", () => {
        els.out.textContent = "";
        els.tbody.innerHTML = `<tr><td colspan="4" class="muted">Нажми “GET /vacancy”</td></tr>`;
        setStatus("");
    });
</script>
</body>
</html>
